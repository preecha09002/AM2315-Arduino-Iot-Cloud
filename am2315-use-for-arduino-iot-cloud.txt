/* 
  Sketch generated by the Arduino IoT Cloud Thing "Untitled 2"
  https://create.arduino.cc/cloud/things/5649f3be-515d-445e-9d8c-6fd628af647b 

  Arduino IoT Cloud Variables description

  The following variables are automatically generated and updated when changes are made to the Thing

  CloudTemperatureSensor temperature2;
  CloudRelativeHumidity humidity2;
  bool led01;

  Variables which are marked as READ/WRITE in the Cloud Thing will also have functions
  which are called when their values are changed from the Dashboard.
  These functions are generated with the Thing and added at the end of this sketch.
*/ 
#include "thingProperties.h"
#include <AM2315_I2C.h>

//ESP8266 I2C Pins
const uint8_t dataPin = D2;
const uint8_t  clockPin = D1;

AM2315_I2C am2315;

void setup() { 
  Serial.begin(9600); 
  delay(1500); 
  initProperties();
  ArduinoCloud.begin(ArduinoIoTPreferredConnection);
  setDebugMessageLevel(2);
  ArduinoCloud.printDebugInfo();
  while(!ArduinoCloud.connected()) {
    ArduinoCloud.update();
    delay(5);
  }
  Wire.pins(dataPin, clockPin);
  delay(100);

  Serial.println();

  am2315.begin(dataPin, clockPin);

  if (!am2315.dataReady)
  Serial.println("AM2315 sensor was not found");
  else
  Serial.println("AM2315 sensor is ready");
}

void loop() { 
  ArduinoCloud.update();
  //Non-blocking data reading
  am2315.acquireData();

  if (am2315.dataReady) {
    temperature2 = am2315.temperature();
    humidity2 = am2315.humidity();
    Serial.print("Humidity: ");
    Serial.println(temperature2);
    Serial.print("Temperature: ");
    Serial.println(humidity2);
    Serial.println(); 
  }
}

 

/*
  Since Led01 is READ_WRITE variable, onLed01Change() is
  executed every time a new value is received from IoT Cloud.
*/
void onLed01Change()  
{
    if(led01 == LOW)
  {
    Serial.println("Led Off"); 
  }
  else
  {
    Serial.println("Led On"); 
  }
}







